<!DOCTYPE html>

<html lang="pt-br">
    <head>
        <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet" />

        <link href="css/dashboard.css" rel="stylesheet" />
        <link href="css/default.css" rel="stylesheet" />
        <link href="css/header.css" rel="stylesheet" />

        <link rel="stylesheet" href="css/">

        <meta charset="UTF-8" />
        <meta content="initial-scale=1.0, width=device-width" name="viewport" />
        <meta content="ie=edge" http-equiv="X-UA-Compatible" />

        <title>Sparkling Lab - Dashboard</title>
    </head>

    <body>
        <header class="header">
            <nav class="container header_nav">
                <a class="logo" href="#"><img style="height: 75px;" src="./img/logo_finalizada.png" alt=""></a>

                <!-- TIP: Será estilizado como um botão, embora seja um link para outra página. -->
                <a class="button" href="charts.html">Graficos</a>
                <a class="button" href="sign-in.html">Sair</a>
            </nav>
        </header>

        <main class="container" id="container">
            <h3 id="nextPaymentElRef">
                Este mês você já poupou R$1.250,00
            </h3>

            <div class="menu">
                <button onclick="fetchAndShowAreas()">Monitorar em Tempo Real</button>
            </div>

            <div id="areasElRef"></div>
        </main>

        <footer class="container">
            <a class="logo" href="#">Sparkling Lab</a>
            Todos os direitos reservados &copy; 2019
        </footer>

        <script>
            var months = [
                "Janeiro",
                "Fevereiro",
                "Março",
                "Abril",
                "Maio",
                "Junho",
                "Julho",
                "Agosto",
                "Setembro",
                "Outubro",
                "Novembro",
                "Dezembro"
            ];
            var today = new Date();
            var nextPayment = new Date();
            nextPayment.setMonth(today.getMonth() + 1);

            nextPaymentElRef.innerHTML += `
                <br>
                O seu próximo pagamento será em 01 de ${months[nextPayment.getMonth()]}
            `;

            function fetchAndShowAreas() {
                areasElRef.innerHTML = "";

                var areas = [
                    {
                        id: 0,
                        description: "Garagem"
                    },
                    {
                        id: 1,
                        description: "Elevador"
                    },
                    {
                        id: 2,
                        description: "Área externa"
                    }
                ];

                areasElRef.innerHTML += `<div onclick="atualizarLampada()" id="areaSelectionElRef"></div>`;

                for (var i = 0; i < areas.length; i++) {
                    areaSelectionElRef.innerHTML += `<button onclick="fetchAndShowLamps(${areas[i].id})">${areas[i].description}</button>`;
                }

                areasElRef.innerHTML += `<div id="lampsElRef"></div>`;
            }

            function fetchAndShowLamps(areaId) {
                lampsElRef.innerHTML = "";

                var lamps = [
                    {
                        id: 0,
                        description: "Entrada"
                    },
                    {
                        id: 1,
                        description: "Saída"
                    },
                    {
                        id: 2,
                        description: "Escadaria"
                    }
                ];

                lampsElRef.innerHTML += `<div id="lampSelectionElRef"></div>`;

                for (var i = 0; i < lamps.length; i++) {
                    lampSelectionElRef.innerHTML += `<button onclick="fetchAndShowChart(${lamps[i].id})">${lamps[i].description}</button>`;
                }

                lampsElRef.innerHTML += `<div style="display: inline-flex; width:70%" id="chartElRef">
                        <img style="width:50%;" src="./img/lamp(7).png" alt="" id="lampada" class="lampada">

                        <div style="width:50%; font-size: 15px; text-align:center;">
                            Status da Lampada: <span id="status_lampada">Desligada</span> <br><br><br>
                            Gasto por mês: R$ <span id="lamp_gasto_mes"></span><br><br><br>
                            Economizado no mês: R$ <span id="economizado_mes"></span>
    
                        </div>
                        

                    
                    </div>`;
            }

            function fetchAndShowChart(lampId) {
                chartElRef.innerHTML = `${lampId}`;
            }













        function get_data(){
			var http = new XMLHttpRequest();
            http.open('GET', 'http://localhost:3000/api', false);
            http.send(null);        
			
			var obj = JSON.parse(http.responseText);
			
			console.log(obj.data[obj.data.length - 1]);

            if(obj.data == ''){

                lampada.src = "./img/lamp(7).png";
                status_lampada.innerHTML = 'Desligada';
                lamp_gasto_mes.innerHTML = '';
                economizado_mes.innerHTML = '';

            }else if(obj.data[obj.data.length - 1] >= 0 && obj.data[obj.data.length - 1] <= 127){
				
                
                status_lampada.innerHTML = 'Desligada';
                lamp_gasto_mes.innerHTML = 'Nenhum gasto pois a lâmpada esta desligada';
                
                economizado_mes.innerHTML = 'Não tem o que economizar';

                console.log(1);
                                
				lampada.src = "./img/lamp(7).png";

				
			}else if(obj.data[obj.data.length - 1] > 127 && obj.data[obj.data.length - 1] <= 254){

                var qtd_dia = 1;
                var qtd_lampada = 1;

                var gasto_energia_watts = 100 * 3 * qtd_dia * qtd_lampada
                var gasto_energia_quilo_watts = gasto_energia_watts / 1000
                var gasto_energia_real = (gasto_energia_quilo_watts * 6) * 0.85
                var gasto_dia = gasto_energia_real / qtd_dia
                var gasto_mes = gasto_dia * 30

                var econo_gasto_energia_watts = 100 * 12 * qtd_dia * qtd_lampada
                var econo_gasto_energia_quilo_watts = econo_gasto_energia_watts / 1000
                var econo_gasto_energia_real = (econo_gasto_energia_quilo_watts * 6) * 0.85
                var econo_gasto_dia = econo_gasto_energia_real / qtd_dia
                var econo_gasto_mes = econo_gasto_dia * 30

                status_lampada.innerHTML = 'Ligada'
                lamp_gasto_mes.innerHTML = `${gasto_mes.toFixed(2)}`;

                economizado_mes.innerHTML = `${(econo_gasto_mes - gasto_mes).toFixed(2)}`;

				console.log(2);
				
				lampada.src = "./img/lamp(6).png";

			}else if(obj.data[obj.data.length - 1] > 254 && obj.data[obj.data.length - 1] <= 381){


                var qtd_dia = 1;
                var qtd_lampada = 1;

                var gasto_energia_watts = 100 * 5 * qtd_dia * qtd_lampada
                var gasto_energia_quilo_watts = gasto_energia_watts / 1000
                var gasto_energia_real = (gasto_energia_quilo_watts * 6) * 0.85
                var gasto_dia = gasto_energia_real / qtd_dia
                var gasto_mes = gasto_dia * 30

                var econo_gasto_energia_watts = 100 * 12 * qtd_dia * qtd_lampada
                var econo_gasto_energia_quilo_watts = econo_gasto_energia_watts / 1000
                var econo_gasto_energia_real = (econo_gasto_energia_quilo_watts * 6) * 0.85
                var econo_gasto_dia = econo_gasto_energia_real / qtd_dia
                var econo_gasto_mes = econo_gasto_dia * 30

                status_lampada.innerHTML = 'Ligada'
                lamp_gasto_mes.innerHTML = `${gasto_mes.toFixed(2)}`;

                economizado_mes.innerHTML = `${(econo_gasto_mes - gasto_mes).toFixed(2)}`;

				console.log(3);
				
				lampada.src = "./img/lamp(5).png";

			}else if(obj.data[obj.data.length - 1] > 381 && obj.data[obj.data.length - 1] <= 508){
				

                var qtd_dia = 1;
                var qtd_lampada = 1;

                var gasto_energia_watts = 100 * 6 * qtd_dia * qtd_lampada
                var gasto_energia_quilo_watts = gasto_energia_watts / 1000
                var gasto_energia_real = (gasto_energia_quilo_watts * 6) * 0.85
                var gasto_dia = gasto_energia_real / qtd_dia
                var gasto_mes = gasto_dia * 30

                var econo_gasto_energia_watts = 100 * 12 * qtd_dia * qtd_lampada
                var econo_gasto_energia_quilo_watts = econo_gasto_energia_watts / 1000
                var econo_gasto_energia_real = (econo_gasto_energia_quilo_watts * 6) * 0.85
                var econo_gasto_dia = econo_gasto_energia_real / qtd_dia
                var econo_gasto_mes = econo_gasto_dia * 30

                status_lampada.innerHTML = 'Ligada'
                lamp_gasto_mes.innerHTML = `${gasto_mes.toFixed(2)}`;

                economizado_mes.innerHTML = `${(econo_gasto_mes - gasto_mes).toFixed(2)}`;

				console.log(4);
				
				lampada.src = "./img/lamp(4).png";

			}else if(obj.data[obj.data.length - 1] > 508 && obj.data[obj.data.length - 1] <= 635){
				
                var qtd_dia = 1;
                var qtd_lampada = 1;

                var gasto_energia_watts = 100 * 7 * qtd_dia * qtd_lampada
                var gasto_energia_quilo_watts = gasto_energia_watts / 1000
                var gasto_energia_real = (gasto_energia_quilo_watts * 6) * 0.85
                var gasto_dia = gasto_energia_real / qtd_dia
                var gasto_mes = gasto_dia * 30

                var econo_gasto_energia_watts = 100 * 12 * qtd_dia * qtd_lampada
                var econo_gasto_energia_quilo_watts = econo_gasto_energia_watts / 1000
                var econo_gasto_energia_real = (econo_gasto_energia_quilo_watts * 6) * 0.85
                var econo_gasto_dia = econo_gasto_energia_real / qtd_dia
                var econo_gasto_mes = econo_gasto_dia * 30

                status_lampada.innerHTML = 'Ligada'
                lamp_gasto_mes.innerHTML = `${gasto_mes.toFixed(2)}`;

                economizado_mes.innerHTML = `${(econo_gasto_mes - gasto_mes).toFixed(2)}`;

				console.log(5);
				
				lampada.src = "./img/lamp(3).png";

			}else if(obj.data[obj.data.length - 1] > 635 && obj.data[obj.data.length - 1] <= 762){
				

                var qtd_dia = 1;
                var qtd_lampada = 1;

                var gasto_energia_watts = 100 * 8 * qtd_dia * qtd_lampada
                var gasto_energia_quilo_watts = gasto_energia_watts / 1000
                var gasto_energia_real = (gasto_energia_quilo_watts * 6) * 0.85
                var gasto_dia = gasto_energia_real / qtd_dia
                var gasto_mes = gasto_dia * 30

                var econo_gasto_energia_watts = 100 * 12 * qtd_dia * qtd_lampada
                var econo_gasto_energia_quilo_watts = econo_gasto_energia_watts / 1000
                var econo_gasto_energia_real = (econo_gasto_energia_quilo_watts * 6) * 0.85
                var econo_gasto_dia = econo_gasto_energia_real / qtd_dia
                var econo_gasto_mes = econo_gasto_dia * 30

                status_lampada.innerHTML = 'Ligada'
                lamp_gasto_mes.innerHTML = `${gasto_mes.toFixed(2)}`;

                economizado_mes.innerHTML = `${(econo_gasto_mes - gasto_mes).toFixed(2)}`;

				console.log(6);
				
				lampada.src = "./img/lamp(2).png";

			}else if(obj.data[obj.data.length - 1] > 762 && obj.data[obj.data.length - 1] <= 889){
				

                var qtd_dia = 1;
                var qtd_lampada = 1;

                var gasto_energia_watts = 100 * 10 * qtd_dia * qtd_lampada
                var gasto_energia_quilo_watts = gasto_energia_watts / 1000
                var gasto_energia_real = (gasto_energia_quilo_watts * 6) * 0.85
                var gasto_dia = gasto_energia_real / qtd_dia
                var gasto_mes = gasto_dia * 30

                var econo_gasto_energia_watts = 100 * 12 * qtd_dia * qtd_lampada
                var econo_gasto_energia_quilo_watts = econo_gasto_energia_watts / 1000
                var econo_gasto_energia_real = (econo_gasto_energia_quilo_watts * 6) * 0.85
                var econo_gasto_dia = econo_gasto_energia_real / qtd_dia
                var econo_gasto_mes = econo_gasto_dia * 30

                status_lampada.innerHTML = 'Ligada'
                lamp_gasto_mes.innerHTML = `${gasto_mes.toFixed(2)}`;

                economizado_mes.innerHTML = `${(econo_gasto_mes - gasto_mes).toFixed(2)}`;

				console.log(7);
				
				lampada.src = "./img/lamp(1).png";

			}else{
                
                var qtd_dia = 1;
                var qtd_lampada = 1;

                var gasto_energia_watts = 100 * 12 * qtd_dia * qtd_lampada
                var gasto_energia_quilo_watts = gasto_energia_watts / 1000
                var gasto_energia_real = (gasto_energia_quilo_watts * 6) * 0.85
                var gasto_dia = gasto_energia_real / qtd_dia
                var gasto_mes = gasto_dia * 30

                var econo_gasto_energia_watts = 100 * 12 * qtd_dia * qtd_lampada
                var econo_gasto_energia_quilo_watts = econo_gasto_energia_watts / 1000
                var econo_gasto_energia_real = (econo_gasto_energia_quilo_watts * 6) * 0.85
                var econo_gasto_dia = econo_gasto_energia_real / qtd_dia
                var econo_gasto_mes = econo_gasto_dia * 30

                status_lampada.innerHTML = 'Ligada na potência maxima';
                lamp_gasto_mes.innerHTML = `${gasto_mes.toFixed(2)}`;

                economizado_mes.innerHTML = `${(econo_gasto_mes - gasto_mes).toFixed(2)}`;
				console.log(8);

				lampada.src = "./img/lamp.png";

			}
		}
		
		get_data();


        function atualizarLampada(){
            get_data();
            setTimeout(atualizarLampada, 1000);
	    }

        // setTimeout(() => {
        //     get_data();
		// }, 500);

        </script>
    </body>
</html>
