<!DOCTYPE html>

<html lang="pt-br">
    <head>
        <link rel="stylesheet" href="css/default.css" />
        <link rel="stylesheet" href="css/header.css" />
        <link rel="stylesheet" href="css/sign-in.css" />

        <meta charset="UTF-8" />
        <meta content="initial-scale=1.0, width=device-width" name="viewport" />
        <meta content="ie=edge" http-equiv="X-UA-Compatible" />

        <title>Sparkling Lab - Autenticação</title>
    </head>

    <body class="center">
        <main class="center container">
            <form class="center container" id="form_login" method="post" onsubmit="return entrar()">
            <h1>Autenticação</h1>
                
                <label>
                    <div>Email</div>
                    <input name="email" type="email" placeholder="maria@exemplo.com.br" />
                </label>
    
                <label>
                    <div>Senha</div>
                    <input name="senha" type="password" />
                </label>
    
              <button class="button" id="btn_entrar">Entrar</button>
            </form>
            <div id="div_erro" style="background-color: sandybrown; color: maroon; display: none;">
            <div>
                <a class="link" href="sign-up.html">
                    Cadastrar
                </a>
                &bullet;
                <a class="link" href="recovery.html">
                    Recuperar senha
                </a>
            </div>
            <div id="div_erro" style="background-color: sandybrown; color: maroon; display: none;"></div>
        </main>

        <footer class="container footer-fix">
            <a class="logo" href="index.html">Sparkling Lab</a>
            Todos os direitos reservados &copy; 2019
        </footer>
    </body>
</html>

<script>

function entrar() {
        
        var formulario = new URLSearchParams(new FormData(form_login));
        fetch("/sindico/autenticar", {
            method: "POST",
            body: formulario
        }).then(resposta => {
            
            if (resposta.ok) {

                resposta.json().then(json => {

                    sessionStorage.login_usuario_meuapp = json.email;
                    sessionStorage.nome_usuario_meuapp = json.nome;
                    
                    window.location.href = 'charts.html';
                });

            } else {

                console.log('Erro de login!');

                div_erro.style.display = 'block';
                div_erro.innerHTML = resposta;

                response.text().then(texto => {
                    console.error(texto);
                    
                });
            }
        });

        return false;
    }

</script>